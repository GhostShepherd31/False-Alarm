<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>False Alarm â€” Compatibility Scoring Dashboard</title>
  <meta name="description" content="An upgraded compatibility scoring dashboard with trait weighting, penalty decay, scenario presets, radar charts, and Excel export." />

  <!-- Chart.js for radar chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --bg: #0b1020;
      --card: #121a33;
      --muted: #9aa3c9;
      --text: #e9eeff;
      --accent: #7cf5c6;
      --accent2: #83a7ff;
      --danger: #ff6b6b;
      --ok: #58d07c;
      --ring: rgba(124, 245, 198, 0.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, #1b2550 0%, transparent 60%),
                  radial-gradient(900px 700px at 110% 10%, #182042 0%, transparent 50%),
                  var(--bg);
      color: var(--text);
    }

    a { color: var(--accent2); }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    header { display: flex; gap: 14px; align-items: center; justify-content: space-between; margin-bottom: 18px; }
    .title { display: flex; gap: 12px; align-items: center; }
    .emoji-siren { font-size: 2em; animation: blink 0.5s infinite alternate; }
    @keyframes blink { 0% { opacity: 1; } 100% { opacity: 0.3; } }

    h1 { font-size: clamp(22px, 3.5vw, 32px); margin: 0; font-weight: 800; letter-spacing: 0.2px; }
    .sub { color: var(--muted); font-size: 0.95rem; }

    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; }
    .btn {
      background: #1c2646;
      color: var(--text);
      border: 1px solid #26305a;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn:hover { border-color: #33407a; }
    .btn.primary {
      background: linear-gradient(135deg, #1f8859, #246bff);
      border: none;
      box-shadow: 0 8px 30px rgba(124, 245, 198, 0.25);
    }
    .btn.ghost { background: transparent; border: 1px dashed #37406f; }
    .btn.danger { background: #2b1930; border: 1px solid #5a2b53; }

    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 14px; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0));
      border: 1px solid #2a345f;
      border-radius: 18px;
      padding: 16px 14px;
    }
    .card h2 { margin: 0 0 8px 0; font-size: 1.1rem; }

    table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    thead th {
      font-size: 0.85rem;
      color: var(--muted);
      font-weight: 600;
      text-align: left;
      padding: 0 8px;
    }
    tbody td {
      background: #121936;
      border: 1px solid #27305a;
      padding: 8px;
      border-left: none;
      border-right: none;
      vertical-align: middle;
    }
    tbody tr td:first-child {
      border-left: 1px solid #27305a;
      border-radius: 12px 0 0 12px;
    }
    tbody tr td:last-child {
      border-right: 1px solid #27305a;
      border-radius: 0 12px 12px 0;
    }

    input[type="text"], input[type="number"], select {
      width: 100%;
      background: #0e1530;
      color: var(--text);
      border: 1px solid #2b3561;
      border-radius: 10px;
      padding: 9px;
    }
    input[type="range"] {
      width: 100%;
      margin-top: 4px;
    }
    input[type="checkbox"] { width: 18px; height: 18px; }
    label.small { color: var(--muted); font-size: 0.85rem; }

    .score { font-size: 42px; font-weight: 900; letter-spacing: 1px; margin: 8px 0; }
    .score small { font-size: 14px; color: var(--muted); font-weight: 600; }

    .meter {
      height: 14px;
      background: #0f1836;
      border: 1px solid #2a365f;
      border-radius: 10px;
      overflow: hidden;
    }
    .meter > div {
      height: 100%;
      background: linear-gradient(90deg, var(--danger), #ffb86b, #fff08b, #a6ff8f);
      width: 0%;
    }

    .row-tools { display: flex; gap: 6px; align-items: center; }
    .pill { font-size: 0.78rem; padding: 4px 8px; border-radius: 999px; border: 1px solid #2a376b; color: var(--muted); }
    .muted { color: var(--muted); }
    .flex { display: flex; gap: 10px; flex-wrap: wrap; }
    .hidden { display: none; }
    .divider { height: 1px; background: #26305a; margin: 12px 0; }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border: 1px solid #2a376b;
      border-radius: 999px;
    }
    .tag .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="emoji-siren" aria-hidden="true">ðŸš¨</div>
        <div>
          <h1>False Alarm</h1>
          <div class="sub">Compatibility scoring dashboard</div>
        </div>
      </div>
      <div class="toolbar">
        <select id="scenario">
          <option value="default">Default</option>
          <option value="first-date">First Date</option>
          <option value="long-term">Long-Term</option>
          <option value="situationship">Situationship</option>
        </select>
        <button class="btn ghost" id="btn-new">New</button>
        <button class="btn" id="btn-save">Save</button>
        <button class="btn primary" id="btn-export">Export to Excel</button>
        <input id="file-import" class="hidden" type="file" accept="application/json" />
      </div>
    </header>

    <!-- Profile -->
    <section class="card">
      <h2>1) Profile</h2>
      <div class="flex">
        <div style="min-width:220px;flex:1">
          <label class="small">You are</label>
          <select id="user-gender">
            <option value="">Selectâ€¦</option>
            <option>Man</option>
            <option>Woman</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
          </select>
        </div>
        <div style="min-width:220px;flex:1">
          <label class="small">Your date is</label>
          <select id="partner-gender">
            <option value="">Selectâ€¦</option>
            <option>Man</option>
            <option>Woman</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
          </select>
        </div>
        <div style="min-width:260px;flex:2">
          <label class="small">Notes (optional)</label>
          <input id="profile-notes" type="text" placeholder="Context, date, etc." />
        </div>
      </div>
    </section>

    <!-- Qualities -->
    <section class="card">
      <h2>2) Qualities</h2>
      <div class="flex" style="justify-content:space-between;align-items:end">
        <div class="muted">Each trait has a rating (1â€“5) and a weight (1â€“5). Final score = rating Ã— weight.</div>
        <div class="flex">
          <input id="add-quality-name" type="text" placeholder="Add custom quality" style="min-width:220px" />
          <button class="btn" id="btn-add-quality">Add</button>
        </div>
      </div>
      <p id="quality-warning" style="display:none;color:#ffbf00;margin:8px 0 0;">Max 20 traits allowed.</p>
      <div class="divider"></div>
      <table>
        <thead>
          <tr>
            <th>Quality</th>
            <th>Rating</th>
            <th>Weight</th>
            <th>Score</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody id="qualities-body"></tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align:right;padding-right:10px;color:var(--muted)">Total Compatibility</td>
            <td id="total-compat" style="font-weight:800">0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </section>

    <!-- Red Flags -->
    <section class="card">
      <h2>3) Red Flags</h2>
      <div class="flex" style="justify-content:space-between;align-items:end">
        <div class="muted">Toggle present? to apply penalty. Decay factor softens impact.</div>
        <div class="flex">
          <input id="add-flag-name" type="text" placeholder="Add red flag" style="min-width:220px" />
          <input id="add-flag-pen" type="number" placeholder="Penalty (e.g., -300)" style="width:140px" />
          <input id="add-flag-decay" type="number" placeholder="Decay (0â€“1)" step="0.1" style="width:100px" />
          <button class="btn danger" id="btn-add-flag">Add</button>
        </div>
      </div>
      <div class="divider"></div>
      <table>
        <thead>
          <tr>
            <th>Red Flag</th>
            <th>Present?</th>
            <th>Penalty</th>
            <th>Decay</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody id="flags-body"></tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align:right;padding-right:10px;color:var(--muted)">Total Penalty</td>
            <td id="total-penalty" style="font-weight:800">0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </section>

    <!-- Results -->
    <section class="card">
      <h2>4) Result</h2>
      <div class="flex" style="align-items:center">
        <div style="min-width:220px">
          <div class="muted">Overall</div>
          <div class="score" id="final-score">0 <small>/ 500</small></div>
        </div>
        <div style="flex:1">
          <div class="meter" aria-hidden="true"><div id="meter-bar"></div></div>
          <canvas id="radarChart" style="margin-top:20px;max-width:100%;"></canvas>
        </div>
        <div style="min-width:240px;text-align:right">
          <div class="muted">Band</div>
          <div id="band" style="font-weight:800;font-size:18px">â€”</div>
        </div>
      </div>
    </section>

    <footer class="muted" style="text-align:center;margin:16px 0 40px">All data stays in your browser. Export to Excel to share. âœ¨</footer>
  </div>

  <!-- Scripts -->
  <script>
    // Your full JavaScript logic goes here â€” including state, rendering, compute, radar chart, Excel export, and event bindings.
    // Iâ€™ll deliver this next so you have the complete file.
  </script>
</body>
</html>
<script>
const MAX_TRAITS = 20;
const state = {
  profile: { userGender: '', partnerGender: '', notes: '', scenario: 'default' },
  qualities: [],
  flags: []
};

const DEFAULT_QUALITIES = [
  "Attractiveness","Self-care","Intelligent","Honest","Humor","Consistency",
  "Open-Minded","Empathy","Kindness","Maturity","Confidence","Emotionally stable",
  "Authentic","Supportive","Respectful","Shared values","Ambition","Communication",
  "Loyalty","Accountability"
];

const DEFAULT_FLAGS = [
  ["Poor hygiene", -200, 1.0],
  ["Substance abuse", -300, 1.0],
  ["Extreme jealousy", -300, 0.8],
  ["Still entangled with an ex", -200, 0.7],
  ["Disrespect toward service staff", -400, 0.9],
  ["Violates boundaries repeatedly", -300, 1.0],
  ["Criminal activity", -500, 1.0],
  ["Controlling or manipulative", -300, 0.9]
];

const byId = id => document.getElementById(id);

function escapeHtml(s){
  return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
}

function renderQualities(){
  const tbody = byId('qualities-body');
  tbody.innerHTML = '';
  state.qualities.forEach((q, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(q.name)}</td>
      <td>
        <select data-idx="${idx}" class="rating">
          ${[1,2,3,4,5].map(v=>`<option ${q.rating==v?'selected':''}>${v}</option>`).join('')}
        </select>
      </td>
      <td>
        <input type="range" min="1" max="5" value="${q.weight}" data-weight-idx="${idx}" />
      </td>
      <td><strong>${q.rating * q.weight}</strong></td>
      <td><button class="btn danger" data-remove-quality="${idx}">Remove</button></td>
    `;
    tbody.appendChild(tr);
  });
  bindQualityEvents();
  compute();
}

function renderFlags(){
  const tbody = byId('flags-body');
  tbody.innerHTML = '';
  state.flags.forEach((f, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(f.name)}</td>
      <td style="text-align:center"><input type="checkbox" data-flag-present="${idx}" ${f.present?'checked':''} /></td>
      <td><strong>${f.penalty}</strong></td>
      <td><input type="number" step="0.1" min="0" max="1" value="${f.decay}" data-decay-idx="${idx}" /></td>
      <td><button class="btn danger" data-remove-flag="${idx}">Remove</button></td>
    `;
    tbody.appendChild(tr);
  });
  bindFlagEvents();
  compute();
}

function compute(){
  const scenario = state.profile.scenario || 'default';
  let totalCompat = state.qualities.reduce((sum,q)=> sum + q.rating * q.weight, 0);
  let totalPenalty = state.flags.reduce((sum,f)=> sum + (f.present ? f.penalty * f.decay : 0), 0);

  // Scenario logic
  if(scenario === 'first-date') totalPenalty *= 1.2;
  if(scenario === 'long-term') totalCompat *= 1.2;
  if(scenario === 'situationship') {
    totalCompat *= 0.9;
    totalPenalty *= 0.9;
  }

  const final = Math.max(0, Math.round(totalCompat + totalPenalty));
  byId('total-compat').textContent = Math.round(totalCompat);
  byId('total-penalty').textContent = Math.round(totalPenalty);
  byId('final-score').innerHTML = `${final} <small>/ 500</small>`;
  byId('meter-bar').style.width = Math.min(100, (final/500)*100) + '%';
  byId('band').textContent = classify(final);
  renderRadarChart();
}

function classify(score){
  if(score>=450) return 'Life Partner';
  if(score>=300) return 'Potential GF/BF';
  if(score>=100) return 'Friend w/ Benefits';
  if(score>=50)  return 'One time only';
  return 'Stay Away';
}

function bindQualityEvents(){
  document.querySelectorAll('select.rating').forEach(sel=>{
    sel.addEventListener('change', e=>{
      const idx = Number(e.target.dataset.idx);
      state.qualities[idx].rating = Number(e.target.value);
      renderQualities();
    });
  });
  document.querySelectorAll('input[data-weight-idx]').forEach(slider=>{
    slider.addEventListener('input', e=>{
      const idx = Number(e.target.dataset.weightIdx);
      state.qualities[idx].weight = Number(e.target.value);
      compute();
    });
  });
  document.querySelectorAll('button[data-remove-quality]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const idx = Number(e.target.getAttribute('data-remove-quality'));
      state.qualities.splice(idx,1);
      renderQualities();
    });
  });
}

function bindFlagEvents(){
  document.querySelectorAll('input[data-flag-present]').forEach(chk=>{
    chk.addEventListener('change', e=>{
      const idx = Number(e.target.getAttribute('data-flag-present'));
      state.flags[idx].present = e.target.checked;
      compute();
    });
  });
  document.querySelectorAll('input[data-decay-idx]').forEach(input=>{
    input.addEventListener('input', e=>{
      const idx = Number(e.target.dataset.decayIdx);
      state.flags[idx].decay = Math.max(0, Math.min(1, Number(e.target.value)));
      compute();
    });
  });
  document.querySelectorAll('button[data-remove-flag]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const idx = Number(e.target.getAttribute('data-remove-flag'));
      state.flags.splice(idx,1);
      renderFlags();
    });
  });
}

function renderRadarChart(){
  const ctx = byId('radarChart').getContext('2d');
  const labels = state.qualities.map(q => q.name);
  const data = state.qualities.map(q => q.rating * q.weight);
  if(window.radarChart) window.radarChart.destroy();
  window.radarChart = new Chart(ctx, {
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: 'Trait Score',
        data,
        backgroundColor: 'rgba(124,245,198,0.2)',
        borderColor: 'rgba(124,245,198,1)',
        borderWidth: 2
      }]
    },
    options: {
      scales: { r: { angleLines: { display: false }, suggestedMin: 0, suggestedMax: 25 } },
      plugins: { legend: { display: false } }
    }
  });
}

function loadDefaults(){
  state.qualities = DEFAULT_QUALITIES.slice(0, MAX_TRAITS).map(name => ({ name, rating: 5, weight: 5 }));
  state.flags = DEFAULT_FLAGS.map(([name, penalty, decay]) => ({ name, penalty, decay, present: false }));
}

function hydrate(){
  byId('user-gender').value = state.profile.userGender || '';
  byId('partner-gender').value = state.profile.partnerGender || '';
  byId('profile-notes').value = state.profile.notes || '';
  byId('scenario').value = state.profile.scenario || 'default';
  renderQualities();
  renderFlags();
}

function bindProfile(){
  byId('user-gender').addEventListener('change', e=> state.profile.userGender = e.target.value);
  byId('partner-gender').addEventListener('change', e=> state.profile.partnerGender = e.target.value);
  byId('profile-notes').addEventListener('input', e=> state.profile.notes = e.target.value);
  byId('scenario').addEventListener('change', e=> {
    state.profile.scenario = e.target.value;
    compute();
  });
}

function save(){
  localStorage.setItem('false-alarm', JSON.stringify(state));
}

function load(){
  const blob = localStorage.getItem('false-alarm');
  if(!blob) return false;
  try {
    Object.assign(state, JSON.parse(blob));
    return true;
  } catch {
    return false;
  }
}

function exportExcel(){
  const wb = XLSX.utils.book_new();
  const profileSheet = XLSX.utils.aoa_to_sheet([
    ['You are', state.profile.user
function exportExcel(){
  const wb = XLSX.utils.book_new();

  const profileSheet = XLSX.utils.aoa_to_sheet([
    ['You are', state.profile.userGender],
    ['Your date is', state.profile.partnerGender],
    ['Notes', state.profile.notes],
    ['Scenario', state.profile.scenario]
  ]);
  XLSX.utils.book_append_sheet(wb, profileSheet, 'Profile');

  const qualitiesSheet = XLSX.utils.aoa_to_sheet([
    ['Quality', 'Rating', 'Weight', 'Score'],
    ...state.qualities.map(q => [q.name, q.rating, q.weight, q.rating * q.weight])
  ]);
  XLSX.utils.book_append_sheet(wb, qualitiesSheet, 'Qualities');

  const flagsSheet = XLSX.utils.aoa_to_sheet([
    ['Red Flag', 'Present?', 'Penalty', 'Decay', 'Effective Penalty'],
    ...state.flags.map(f => [
      f.name,
      f.present ? 'Yes' : 'No',
      f.penalty,
      f.decay,
      f.present ? f.penalty * f.decay : 0
    ])
  ]);
  XLSX.utils.book_append_sheet(wb, flagsSheet, 'Red Flags');

  const resultSheet = XLSX.utils.aoa_to_sheet([
    ['Total Compatibility', byId('total-compat').textContent],
    ['Total Penalty', byId('total-penalty').textContent],
    ['Final Score', byId('final-score').textContent],
    ['Band', byId('band').textContent]
  ]);
  XLSX.utils.book_append_sheet(wb, resultSheet, 'Result');

  XLSX.writeFile(wb, 'false-alarm-scorecard.xlsx');
}
byId('btn-export').addEventListener('click', exportExcel);
