<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>False Alarm â€” Compatibility Scoring</title>
  <meta name="description" content="A lightweight, client-side compatibility scoring app you can host on GitHub Pages." />
  <style>
    :root{
      --bg:#0b1020;--card:#121a33;--muted:#9aa3c9;--text:#e9eeff;--accent:#7cf5c6;--accent2:#83a7ff;--danger:#ff6b6b;--ok:#58d07c;--ring: rgba(124,245,198,.35);
    }

    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }

    .emoji-siren {
      animation: flash 1s infinite;
    }
    
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif;background:radial-gradient(1200px 800px at 10% -10%,#1b2550 0%,transparent 60%),radial-gradient(900px 700px at 110% 10%,#182042 0%,transparent 50%),var(--bg);color:var(--text)}
    a{color:var(--accent2)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 30px rgba(127,229,201,.35)}
    h1{font-size:clamp(22px,3.5vw,32px);margin:0;font-weight:800;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:.95rem}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:#1c2646;color:var(--text);border:1px solid #26305a;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn:hover{border-color:#33407a}
    .btn.primary{background:linear-gradient(135deg,#1f8859,#246bff);border:none;box-shadow:0 8px 30px rgba(124,245,198,.25)}
    .btn.ghost{background:transparent;border:1px dashed #37406f}
    .btn.danger{background:#2b1930;border:1px solid #5a2b53}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.0));border:1px solid #2a345f;border-radius:18px;padding:16px 14px}
    .card h2{margin:0 0 8px 0;font-size:1.1rem}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:.85rem;color:var(--muted);font-weight:600;text-align:left;padding:0 8px}
    tbody td{background:#121936;border:1px solid #27305a;padding:8px;border-left:none;border-right:none;vertical-align:middle}
    tbody tr td:first-child{border-left:1px solid #27305a;border-radius:12px 0 0 12px}
    tbody tr td:last-child{border-right:1px solid #27305a;border-radius:0 12px 12px 0}

    input[type="text"], input[type="number"], select{width:100%;background:#0e1530;color:var(--text);border:1px solid #2b3561;border-radius:10px;padding:9px}
    input[type="checkbox"]{width:18px;height:18px}
    label.small{color:var(--muted);font-size:.85rem}

    .score{font-size:42px;font-weight:900;letter-spacing:1px;margin:8px 0}
    .score small{font-size:14px;color:var(--muted);font-weight:600}

    .meter{height:14px;background:#0f1836;border:1px solid #2a365f;border-radius:10px;overflow:hidden}
    .meter>div{height:100%;background:linear-gradient(90deg,var(--danger),#ffb86b,#fff08b,#a6ff8f);width:0%}

    .row-tools{display:flex;gap:6px;align-items:center}
    .pill{font-size:.78rem;padding:4px 8px;border-radius:999px;border:1px solid #2a376b;color:var(--muted)}
    .muted{color:var(--muted)}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .hidden{display:none}
    .divider{height:1px;background:#26305a;margin:12px 0}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid #2a376b;border-radius:999px}
    .tag .dot{width:8px;height:8px;border-radius:999px;background:var(--accent)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="emoji-siren" aria-hidden="true">ðŸš¨</div>
      <div>
          <h1>False Alarm</h1>
          <div class="sub">Compatibility scoring template.</div>
      </div>
      <div class="toolbar">
        <button class="btn ghost" id="btn-new">New</button>
        <button class="btn" id="btn-save">Save</button>
        <button class="btn" id="btn-export">Export JSON</button>
        <button class="btn" id="btn-import">Import JSON</button>
        <input id="file-import" class="hidden" type="file" accept="application/json" />
      </div>
    </header>

    <!-- STEP 1: Profile -->
    <section class="card" id="step-profile">
      <h2>1) Profile</h2>
      <div class="flex">
        <div style="min-width:220px;flex:1">
          <label class="small">You are</label>
          <select id="user-gender">
            <option value="">Selectâ€¦</option>
            <option>Man</option>
            <option>Woman</option>
            <option>Non-binary</option>
          </select>
        </div>
        <div style="min-width:220px;flex:1">
          <label class="small">Your date is</label>
          <select id="partner-gender">
            <option value="">Selectâ€¦</option>
            <option>Man</option>
            <option>Woman</option>
            <option>Non-binary</option>
          </select>
        </div>
        <div style="min-width:260px;flex:2">
          <label class="small">Notes (optional)</label>
          <input id="profile-notes" type="text" placeholder="Name, date, etc." />
        </div>
      </div>
    </section>

    <div class="grid">
      <!-- STEP 2: Qualities -->
      <section class="card" id="step-qualities">
        <div class="flex" style="justify-content:space-between;align-items:end">
          <div>
            <h2>2) Qualities</h2>
            <div class="muted">Choose a partner rating (1â€“5). Weighted = 5 Ã— rating.You can only select up to 20 traits.</div>
          </div>
          <div class="flex">
            <input id="add-quality-name" type="text" placeholder="Add custom quality" style="min-width:220px" />
            <button class="btn" id="btn-add-quality">Add</button>
          </div>
        </div>

        <!-- moved warning outside the flex row -->
        <p id="quality-warning" style="display:none;color:#ffbf00;margin:8px 0 0;">
          You can only select up to 20 good traits.
        </p>

        <div class="divider"></div>
        <table>
          <thead>
            <tr>
              <th>Quality</th>
              <th style="width:120px">Standard</th>
              <th style="width:180px">Partner Rating (1â€“5)</th>
              <th style="width:140px">Weighted</th>
              <th style="width:120px">Remove</th>
            </tr>
          </thead>
          <tbody id="qualities-body"></tbody>
          <tfoot>
            <tr>
              <td colspan="3" style="text-align:right;padding-right:10px;color:var(--muted)">Total Compatibility</td>
              <td id="total-compat" style="font-weight:800">0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </section>

      <!-- STEP 3: Red Flags -->
      <section class="card" id="step-redflags">
        <div class="flex" style="justify-content:space-between;align-items:end">
          <div>
            <h2>3) Red Flags</h2>
            <div class="muted">You can delete and add your own red flags.</div>
          </div>
          <div class="flex">
            <input id="add-flag-name" type="text" placeholder="Add custom red flag" style="min-width:220px" />
            <input id="add-flag-pen" type="number" placeholder="Penalty (e.g., -300)" style="width:160px" />
            <button class="btn danger" id="btn-add-flag">Add</button>
          </div>
        </div>
        <div class="divider"></div>
        <table>
          <thead>
            <tr>
              <th>Red Flag</th>
              <th style="width:120px">Present?</th>
              <th style="width:140px">Penalty</th>
              <th style="width:120px">Remove</th>
            </tr>
          </thead>
          <tbody id="flags-body"></tbody>
          <tfoot>
            <tr>
              <td style="text-align:right;padding-right:10px;color:var(--muted)" colspan="2">Dealbreaker Penalty</td>
              <td id="total-penalty" style="font-weight:800">0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </section>
    </div>

    <!-- RESULTS -->
    <section class="card" id="results">
      <h2>4) Result</h2>
      <div class="flex" style="align-items:center">
        <div style="min-width:220px">
          <div class="muted">Overall</div>
          <div class="score" id="final-score">0 <small>/ 500</small></div>
        </div>
        <div style="flex:1">
          <div class="meter" aria-hidden="true"><div id="meter-bar"></div></div>
          <div class="flex" style="justify-content:space-between;margin-top:6px">
            <span class="tag"><span class="dot"></span> Life Partner 450â€“500</span>
            <span class="tag"><span class="dot"></span> Potential GF/BF 300â€“449</span>
            <span class="tag"><span class="dot"></span> FWB 100â€“299</span>
            <span class="tag"><span class="dot"></span> One time 50â€“99</span>
            <span class="tag"><span class="dot" style="background:var(--danger)"></span> Stay Away 0â€“49</span>
          </div>
        </div>
        <div style="min-width:240px;text-align:right">
          <div class="muted">Category</div>
          <div id="band" style="font-weight:800;font-size:18px">â€”</div>
        </div>
      </div>
    </section>

    <footer class="muted" style="text-align:center;margin:16px 0 40px">All data stays in your browser. Export to share. âœ¨</footer>
  </div>

  <script>
  // ---------- Data ----------
  const STANDARD = 5; // fixed
  const MAX_TRAITS = 20;  // renamed from MAX_TRAIT
    
  const DEFAULT_QUALITIES = [
    // Appearance & care
    "Attractiveness","Self-care",
    // Mind & character
    "Intelligent","Honest","Humor","Consistency","Open-Minded","Empathy","Kindness","Maturity","Confidence","Emotionally stable","Authentic",
    // Compatibility
    "Supportive","Respectful","Shared values","Ambition","Similar life goals","Communication",
    // More options
    "Loyalty","Accountability","Financial responsibility","Growth-minded","Family-oriented","Sexual compatibility","Conflict resolution","Time management","Independence","Trustworthy"
  ];

  const DEFAULT_FLAGS = [
    ["Poor hygiene", -200],
    ["Substance abuse", -300],
    ["Severe unmanaged health", -200],
    ["Unclean/Messy", -100],
    ["Unemployed (unwilling to work)", -200],
    ["Financial issues (chronic)", -200],
    ["Wants children (incompatible)", -500],
    ["Public humiliation", -500],
    ["Extreme jealousy", -300],
    ["Still entangled with an ex", -200],
    ["Disrespect toward service staff", -400],
    ["Violates boundaries repeatedly", -300],
    ["Criminal activity", -500],
    ["Discriminatory attitudes", -300],
    ["Controlling or manipulative", -300],
    ["History of unstable relationships", -200],
    ["Physical, verbal, or emotional abuse", -500],
    // Extras
    ["Lying about major facts", -400],
    ["Cheating history (recent)", -300],
    ["Addiction to pornography/gambling", -200]
  ];

  // ---------- State ----------
  const state = {
    profile: { userGender: '', partnerGender: '', notes: '' },
    qualities: [], // {name, rating}
    flags: []      // {name, penalty, present}
  };

  // ---------- Helpers ----------
  const byId = id => document.getElementById(id);

  function renderQualities(){
    const tbody = byId('qualities-body');
    tbody.innerHTML = '';
    state.qualities.forEach((q, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(q.name)}</td>
        <td>5</td>
        <td>
          <select data-idx="${idx}" class="rating">
            ${[1,2,3,4,5].map(v=>`<option ${q.rating==v?'selected':''}>${v}</option>`).join('')}
          </select>
        </td>
        <td><strong>${STANDARD * (Number(q.rating)||1)}</strong></td>
        <td><button class="btn danger" data-remove-quality="${idx}">Remove</button></td>
      `;
      tbody.appendChild(tr);
    });
    bindQualityEvents();
    compute();
  }

  function renderFlags(){
    const tbody = byId('flags-body');
    tbody.innerHTML = '';
    state.flags.forEach((f, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(f.name)}</td>
        <td style="text-align:center"><input type="checkbox" data-flag-present="${idx}" ${f.present?'checked':''} /></td>
        <td><strong>${f.penalty}</strong></td>
        <td><button class="btn danger" data-remove-flag="${idx}">Remove</button></td>
      `;
      tbody.appendChild(tr);
    });
    bindFlagEvents();
    compute();
  }

  function compute(){
    const totalCompat = state.qualities.reduce((sum,q)=> sum + STANDARD * (Number(q.rating)||1), 0);
    const totalPenalty = state.flags.reduce((sum,f)=> sum + (f.present ? Number(f.penalty)||0 : 0), 0);
    const final = Math.max(0, totalCompat + totalPenalty); // penalties are negative numbers

    byId('total-compat').textContent = totalCompat;
    byId('total-penalty').textContent = totalPenalty;
    byId('final-score').innerHTML = `${final} <small>/ 500</small>`;

    const pct = Math.min(100, Math.max(0, (final/500)*100));
    byId('meter-bar').style.width = pct + '%';

    byId('band').textContent = classify(final);
  }

  function classify(score){
    if(score>=450) return 'Life Partner';
    if(score>=300) return 'Potential GF/BF';
    if(score>=100) return 'Friend w/ Benefits';
    if(score>=50)  return 'One time only';
    return 'Stay Away';
  }

  function escapeHtml(s){
    return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
  }

  function bindQualityEvents(){
    document.querySelectorAll('select.rating').forEach(sel=>{
      sel.addEventListener('change', e=>{
        const idx = Number(e.target.dataset.idx);
        state.qualities[idx].rating = Number(e.target.value);
        renderQualities();
      })
    });
    document.querySelectorAll('button[data-remove-quality]').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = Number(e.target.getAttribute('data-remove-quality'));
        state.qualities.splice(idx,1);
        renderQualities();
      })
    });
  }

  function bindFlagEvents(){
    document.querySelectorAll('input[data-flag-present]').forEach(chk=>{
      chk.addEventListener('change', e=>{
        const idx = Number(e.target.getAttribute('data-flag-present'));
        state.flags[idx].present = e.target.checked;
        compute();
      })
    });
    document.querySelectorAll('button[data-remove-flag]').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = Number(e.target.getAttribute('data-remove-flag'));
        state.flags.splice(idx,1);
        renderFlags();
      })
    });
  }

  function loadDefaults(){
    state.qualities = DEFAULT_QUALITIES.slice(0, MAX_TRAITS).map(name => ({ name, rating: 5 }));
    state.flags = DEFAULT_FLAGS.map(([name, penalty]) => ({ name, penalty, present: false }));
  }

  function bindProfile(){
    byId('user-gender').addEventListener('change', e=> state.profile.userGender = e.target.value);
    byId('partner-gender').addEventListener('change', e=> state.profile.partnerGender = e.target.value);
    byId('profile-notes').addEventListener('input', e=> state.profile.notes = e.target.value);
  }

  // Save/Load/Export/Import
  function save(){
    const blob = JSON.stringify(state);
    localStorage.setItem('false-alarm', blob);
  }
  function load(){
    const blob = localStorage.getItem('false-alarm');
    if(!blob) return false;
    try{
      const obj = JSON.parse(blob);
      Object.assign(state, obj);
      return true;
    }catch{ return false; }
  }
  function exportJson(){
    const data = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(data);
    const a = document.createElement('a');
    a.href = url; a.download = 'false-alarm-export.json'; a.click();
    URL.revokeObjectURL(url);
  }
  function importJson(file){
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const obj = JSON.parse(reader.result);
        Object.assign(state, obj);
        hydrate();
        save();
      }catch{ alert('Invalid JSON'); }
    };
    reader.readAsText(file);
  }

  function hydrate(){
    // profile
    byId('user-gender').value = state.profile.userGender||'';
    byId('partner-gender').value = state.profile.partnerGender||'';
    byId('profile-notes').value = state.profile.notes||'';
    // tables
    renderQualities();
    renderFlags();
  }

  // ---------- Init & UI binds ----------
  document.addEventListener('DOMContentLoaded', () => {
    bindProfile();

    if(!load()){
      loadDefaults();
    }
    hydrate();
    compute();

    // Add quality
    byId('btn-add-quality').addEventListener('click', () => {
      const name = (byId('add-quality-name').value || '').trim();
      if(!name) return;

      // guard for 20 traits
      if (state.qualities.length >= MAX_TRAITS) {
        byId('quality-warning').style.display = 'block';  // show warning
        return;  // stop adding
      }

      byId('quality-warning').style.display = 'none';      // hide if previously shown
      state.qualities.push({ name, rating: 5 });
      byId('add-quality-name').value = '';
      renderQualities();
      save();
    });

    // Add flag
    byId('btn-add-flag').addEventListener('click', ()=>{
      const name = (byId('add-flag-name').value||'').trim();
      let pen = Number(byId('add-flag-pen').value||'');
      if(!name) return;
      if(!pen || isNaN(pen)) pen = -100;
      if(pen>0) pen = -Math.abs(pen); // always negative
      state.flags.push({name, penalty: pen, present:false});
      byId('add-flag-name').value='';
      byId('add-flag-pen').value='';
      renderFlags();
      save();
    });

    // New
    byId('btn-new').addEventListener('click', ()=>{
      if(!confirm('Start a new scorecard? This clears current form (saved copy stays in browser).')) return;
      state.profile = {userGender:'', partnerGender:'', notes:''};
      loadDefaults();
      hydrate();
      compute();
    });

    // Save
    byId('btn-save').addEventListener('click', ()=>{ save(); alert('Saved to this browser.'); });

    // Export
    byId('btn-export').addEventListener('click', exportJson);

    // Import
    byId('btn-import').addEventListener('click', ()=> byId('file-import').click());
    byId('file-import').addEventListener('change', e=>{
      const f = e.target.files?.[0]; if(f) importJson(f);
      e.target.value = '';
    });
  });
  </script>
</body>
</html>
